"use strict";$(document).ready(function(){$(".js-open-instructions-button").click(function(){$("."+this.dataset.openInstructions).addClass("is-opened")}),$(".js-on-click-dismissed").each(function(){$(this).find("."+this.dataset.dismissButton).click(function(){$(this).parents(".js-on-click-dismissed").removeClass("is-opened")})})});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},AABB,Action,AddShape,Behaviour,Body,Button,CanvasControl,Circle,Collision,CollisionControl,Demo,Drag,Engine,GJK,Gravity,Line,Mouse,PlayPause,Presets,Queue,Radio,RadioOption,Rectangle,Refresh,Rope,SATColl,Shape,Cord,Toggle,Vector,abs,atan,atan2,can,cancelAnimationFrame,ceil,cos,CanvasCenter,ctxx,customChangePrototype,demo,floor,generateRandomColor,getMax,getMin,getRandomInt,ImpulseResolution,info,info2,info3,info4,isEven,jcan,makeid,pi,plotItinerary,plotting,pow,requestAnimationFrame,round,shape1,shape2,shape3,sin,solveQuadratic,sqr,sqrt,tan,test1,test2,test3,test4,win,hasProp={}.hasOwnProperty,extend=function(t,e){function i(){this.constructor=t}for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},bind=function(t,e){return function(){return t.apply(e,arguments)}};sin=function(t){return Math.sin(t)},cos=function(t){return Math.cos(t)},abs=function(t){return Math.abs(t)},pow=function(t,e){return Math.pow(t,e)},sqrt=function(t){return Math.sqrt(t)},sqr=function(t){return pow(t,2)},atan=function(t){return Math.atan(t)},tan=function(t){return Math.tan(t)},getMin=function(t,e){return Math.min(t,e)},getMax=function(t,e){return Math.max(t,e)},atan2=function(t,e){return Math.atan2(t,e)},floor=function(t){return Math.floor(t)},ceil=function(t){return Math.ceil(t)},round=function(t){return Math.round(t)},pi=Math.PI,isEven=function(t){return t%2===0},solveQuadratic=function(t,e,i){var n,s;return pow(e,2)-4*t*i<0?!1:(n=(-e+Math.sqrt(pow(e,2)-4*t*i))/(2*t),s=(-e-Math.sqrt(pow(e,2)-4*t*i))/(2*t),[n,s])},getRandomInt=function(t,e){return Math.floor(Math.random()*(e-t+1))+t},info=$("#info"),info2=$("#info2"),info3=$("#info3"),info4=$("#info4"),jcan=$("canvas"),can=document.getElementById("canvas1"),ctxx=can.getContext("2d"),win=$(window),requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame,cancelAnimationFrame=window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelRequestAnimationFrame||window.mozCancelAnimationFrame||window.oCancelRequestAnimationFrame||window.oCancelAnimationFrame||window.msCancelRequestAnimationFrame||window.msCancelAnimationFrame,CanvasCenter=function(){this.x=jcan.width()/2,this.y=jcan.height()/2},customChangePrototype=function(t){var e;for(e in t)t.hasOwnProperty(e)&&(this[e]=t[e])},plotItinerary=[],plotting=function(t){var e,i,n;if(plotItinerary.push([plotItinerary.length,t]),plotItinerary.length>100)for(plotItinerary.shift(),i=0,n=plotItinerary.length;n>i;i++)e=plotItinerary[i],e[0]--;return $.plot($("#placeholder"),[plotItinerary],{yaxis:{max:1,min:-1}})},makeid=function(){var t,e,i;for(i="",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=0;5>t;t++)i+=e.charAt(floor(Math.random()*e.length));return i},Array.prototype.compare=function(t){var e,i;if(!t)return!1;if(this.length!==t.length)return!1;for(e=0,i=this.length;i>e;){if(this[e]instanceof Array&&t[e]instanceof Array){if(!this[e].compare(t[e]))return!1}else if(this[e]!==t[e])return!1;e++}return!0},Array.prototype.copy=function(){var t,e,i,n;for(i=[],e=0,n=this.length;n>e;e++)t=this[e],i.push(t);return i},generateRandomColor=function(t){var e,i;for(null==t&&(t=getRandomInt(50,100)/100),e="rgba(",i=1;3>=i;i++)e+=getRandomInt(50,255),e+=",";return e+=t,e+=")"},Button=function(){function t(t,e,i){if(this.name=t,!this.name)throw new Error("Error: Button doesn't have a proper name");return this.selector=[],this.type=null,e&&this.setSelector(e,i),this.core={activates:{},deactivates:{}},this.activated=!1,this}return t.prototype.getType=function(){return this.type},t.prototype.makeSelector=function(t){var e;if(e="Error: missing or invalid Selector",!t)throw new Error(e);if("string"!=typeof t)throw new Error(e);return $(t)},t.prototype.setSelector=function(t,e){return this.selector[0]||this.selector.push(this.makeSelector(t)),e=e||t,this.selector[1]||this.selector.push(this.makeSelector(e)),this},t.prototype.findListener=function(t,e){var i,n,s;if(1===arguments.length)return(s=this.findListener(this.core.activates,e))>0?s:this.findListener(this.core.deactivates,e);for(i in t)if(hasProp.call(t,i)&&(n=t[i],i===e))return n;return-1},t.prototype.setListener=function(t,e,i,n){var s,r;if(this.selector.length){if(s="Error: invalid",!t||"string"!=typeof t)throw new Error(s+" listener");if("object"!==("undefined"==typeof e?"undefined":_typeof(e)))throw new Error(s+" data assignment");if(r=s+" function assignment",null===i&&null===n)throw new Error(r);if("function"!=typeof i&&"function"!=typeof n)throw new Error(r);return i&&this.assignActivation(t,e,i),n&&this.assignDeactivation(t,e,n),this}},t.prototype.removeListener=function(t){return-1!==this.findListener(this.core.activates,t)&&(this.selector[0].off(t),delete this.core.activates[t]),-1!==this.findListener(this.core.deactivates,t)&&(this.selector[1].off(t),delete this.core.deactivates[t]),this},t.prototype.assignActivation=function(t,e,i){var n;return i&&(n=i.bind(null)),n&&e&&(n.data=e),-1===this.findListener(this.core.activates,t)&&(this.core.activates[t]=[],this.selector[0].on(t,e,function(e){return function(i){return e.activation(t,i)}}(this))),n&&this.core.activates[t].push(n),this},t.prototype.assignDeactivation=function(t,e,i){var n;return i&&(n=i.bind(null)),e&&(n.data=e),-1===this.findListener(this.core.deactivates,t)&&(this.core.deactivates[t]=[],this.selector[1].on(t,e,function(e){return function(i){return e.deactivation(t,i)}}(this))),n&&this.core.deactivates[t].push(n),this},t.prototype.activation=function(t,e){return this.activate(t,e)},t.prototype.deactivation=function(t,e){return this.deactivate(t,e)},t.prototype.activate=function(t,e){var i,n,s,r,o,a;if(!this.activated){if(!t)return function(){for(s in this.core.activates)hasProp.call(this.core.activates,s)&&(this.activate(s,e),this.activated=!1);return this.activated=!0,this}.call(this);for(a=this.core.activates[t],r=0,o=a.length;o>r;r++)n=a[r],i=Object.create(e||null),n.data&&(i.data=n.data),n.call(this,i);return this.activated=!0,this}},t.prototype.deactivate=function(t,e){var i,n,s,r,o,a;if(this.activated){if(!t)return function(){for(s in this.core.deactivates)hasProp.call(this.core.deactivates,s)&&(this.deactivate(s,e),this.activated=!0);return this.activated=!1,this}.call(this);for(a=this.core.deactivates[t],r=0,o=a.length;o>r;r++)n=a[r],i=Object.create(e||null),n.data&&(i.data=n.data),n.call(this,i);return this.activated=!1,this}},t}(),Action=function(t){function e(){return e.__super__.constructor.apply(this,arguments),this.type="action",this}return extend(e,t),e.prototype.fire=function(t,e){return this.activation(t,e),this},e.prototype.activation=function(t,e){return this.activate(t,e),this.deactivation(null,e)},e}(Button),Toggle=function(t){function e(){return e.__super__.constructor.apply(this,arguments),this.type="toggle",this}return extend(e,t),e.prototype.setListener=function(t,i,n,s){return s=s||function(){return null},n=n||function(){return null},e.__super__.setListener.call(this,t,i,n,s)},e.prototype.toggle=function(t,e){return this.activation(t,e),this},e.prototype.activation=function(t,e){return this.activated?this.deactivate(t,e):this.activate(t,e)},e.prototype.deactivation=function(t,e){return this},e.prototype.assignDeactivation=function(t,i,n){return e.__super__.assignDeactivation.apply(this,arguments),this.assignActivation(t,i,null)},e.prototype.assignActivation=function(t,i,n){return e.__super__.assignActivation.apply(this,arguments),-1===this.findListener(this.core.deactivates,t)?this.core.deactivates[t]=[]:void 0},e}(Button),RadioOption=function(t){function e(){return e.__super__.constructor.apply(this,arguments),this.type="radio option",this}return extend(e,t),e.prototype.select=function(t,e){return this.activate(t,e)},e.prototype.deselect=function(t,e){return this.deactivate(t,e)},e}(Button),Radio=function(t){function e(){this.options=[],e.__super__.constructor.apply(this,arguments),this.type="radio"}return extend(e,t),e.prototype.setSelector=function(t){var e,i,n,s,r,o;for(o=this.makeSelector(t),i=0;i<o.length;i++)e=o.eq(i).attr("class"),n=o.eq(i).attr("id"),s=n||e,r=n?"#":".",this.add(new RadioOption(s,r+s));return this},e.prototype.setListener=function(t,e,i,n){},e.prototype.add=function(t){var e,i;if(!this.findOption(t)){if(!t.type||"radio option"!==t.type)throw new Error("Error: invalid option to add");return t.index=this.options.length,t.id=makeid(),this.options.push(t),t.deselect(),e=t.assignActivation,t.assignActivation=function(i){return function(n,s,r){return-1===t.findListener(t.core.activates,n)&&t.selector[0].on(n+".adioInternal",s,function(e){return i.selectOption(t)}),e.apply(t,arguments)}}(this),i=t.removeListener,t.removeListener=function(e){return function(e){return-1!==t.findListener(t.core.deactivates,e)&&t.selector[0].off(e+".adioInternal"),i.apply(t,arguments)}}(this)}},e.prototype.remove=function(t){var e,i,n;if(e=this.findOption(t),n="Error: option is missing or not found",!e)throw new Error(n);if(i=e.index,i>this.options.length-1)throw new Error(n);return t=this.options[i],this.options.splice(i,1),!0},e.prototype.selectOption=function(t){var e,i,n,s,r;if(e=this.findOption(t),!e)throw new Error("Error: option is missing or not found");for(r=this.options,n=0,s=r.length;s>n;n++)i=r[n],i.deselect();return this},e.prototype.getOption=function(t){var e;if(null==t||0>t||t>this.options.length)throw new Error("Error: index is not valid");return e=this.options[t],e?e:!1},e.prototype.getLength=function(){return this.options.length},e.prototype.clicked=function(){var t,e,i,n,s;for(s=this.options,e=i=0,n=s.length;n>i;e=++i)if(t=s[e],t.activated)return e;return!1},e.prototype.findOption=function(t){var e,i,n,s,r,o;if(n="Error: input is not a valid option",!t)throw new Error(n);if(i=null==t.id?null:t.id,r=null==t.name?null:t.name,o=null==r?"id":"name",null==o)throw new Error(n);for(s=0;s<this.options.length;s++)if(e=this.options[s],e[o]===t[o])return e;return!1},e}(Button),Queue=function(){function t(){this.storage=[],this.size_=0}return t.prototype.queue=function(t){return t?(this.size_++,this.storage.push(t),!0):!1},t.prototype.peek=function(){return this.size_?this.storage[this.size_-1]:!1},t.prototype.search=function(t){var e,i,n,s;for(s=this.storage,i=0,n=s.length;n>i;i++)if(e=s[i],e.compare(t))return e;return!1},t.prototype.get=function(t){return this.storage[t]?this.storage[t]:null},t.prototype.size=function(){return this.size_},t.prototype.clear=function(){this.size_=0,this.storage=[]},t.prototype.dequeue=function(){return this.size_?(this.size_--,this.storage.pop()):!1},t}(),Rope=function(){function t(t,e){this.shape1=null==t?null:t,this.shape2=null==e?null:e,this.color="grey"}return t.prototype.line=function(){return new Line(this.shape1.physical.position,this.shape2.physical.position)},t.prototype.compare=function(t,e){return t===this.shape1&&e===this.shape2||e===this.shape1&&t===this.shape2},t.prototype.draw=function(t,e){var i;return null==t&&(t=1),i=new Line(this.shape1.physical.position,this.shape2.physical.position),i.draw(t,e||this.color)},t}(),Engine=function(){function t(t){this.request={frame:!0,animation:!1},this.count=0,this.shapes=[],this.lastLoop=new Date,this.thisLoop=null,this.leftOverTime=0,this.accumulator=0,this.ITERATIONS=16,this.fpsCount=1,this.dt=1/this.fpsCount,this.fpsNum=null,this.$fpsSelector=t,this.pageX=0,this.pageY=0,this.fps(t),this.update()}var e;return e={},t.prototype.emit=function(t,i){var n,s,r,o,a,h,p,c;if(e[t]&&e[t].queue.length){for(h=e[t].queue,s=0,r=h.length;r>s;s++)n=h[s],n.fn&&(n.fn.apply(n.scope,[t,i]),n.fn.one&&(c=c||[],n.fn.one=null,c.push(n)));if(c){for(p=[],a=0,o=c.length;o>a;a++)n=c[a],p.push(this.off({topic:t,fn:n.fn}));return p}}},t.prototype.on=function(t,i,n,s){var r;if(e[t]||(e[t]={queue:[]}),i.id||(i.id=makeid()),this.find(t,i.id))throw new Error("duplicates");r=e[t].queue.push({fn:i,scope:n||null,name:s})-1},t.prototype.findByTopic=function(t,i){var n,s,r,o,a;for(a=e[t].queue,n=s=0,r=a.length;r>s;n=++s)if(o=a[n],o.fn.id===i)return{index:n,obj:o};return!1},t.prototype.find=function(t,i){var n,s;if(t===!0){for(n in e)if(hasProp.call(e,n)&&(s=this.findByTopic(n,i)))return s;return!1}return this.findByTopic(t,i)},t.prototype.off=function(t){var i,n;if(e[t.topic]&&e[t.topic].queue.length)return i=t.fn?t.fn.id:t.id,(n=this.find(t.topic,i))?e[t.topic].queue.splice(n.index,1):n},t.prototype.one=function(t,e,i,n){return e.one=!0,this.on.apply(this,arguments)},t.prototype.setupInput=function(t){return this.input={type:t}},t.prototype.resetInput=function(){return this.input=null},t.prototype.fps=function(){return this.thisLoop=(new Date).getTime(),this.accumulator+=this.thisLoop-this.lastLoop,this.elapsedTime=this.thisLoop-this.lastLoop,this.lastLoop=this.thisLoop,this.fpsNum=1e3/this.accumulator,this.$fpsSelector.html(ceil(this.fpsNum))},t.prototype.implement=function(t){return this.shapes.push(t),this.emit("implement",{shape:t,index:this.shapes.length-1,shapes:this.shapes,engine:this})},t.prototype.checkWall=function(t){var e,i,n,s,r;return r=t.get("v"),i=t.get("bounding"),n=1.8,i[0].x>jcan.width()&&(s=r.dot(e=new Vector(1,0)))>0&&r.move(e.scale(-s*n)),i[1].x<0&&(s=r.dot(e=new Vector(-1,0)))>0&&r.move(e.scale(-s*n)),i[0].y>jcan.height()&&(s=r.dot(e=new Vector(0,1)))>0&&r.move(e.scale(-s*n)),i[1].y<0&&(s=r.dot(e=new Vector(0,-1)))>0?r.move(e.scale(-s*n)):void 0},t.prototype.animate=function(){var t,e,i,n,s,r,o;for(this.emit("animate",{timestep:this.dt,cursor:new Vector(this.pageX,this.pageY),engine:this}),i=0;i<this.ITERATIONS;i++)for(this.emit("iterate",{timestep:this.dt,cursor:new Vector(this.pageX,this.pageY),engine:this}),e=0;e<this.shapes.length;e++)t=this.shapes[e],t.integrate(this.dt);for(r=this.shapes,o=[],s=0,n=r.length;n>s;s++)t=r[s],o.push(this.checkWall(t));return o},t.prototype.draw=function(){var t,e,i,n,s;for(ctxx.clearRect(0,0,jcan.width(),jcan.height()),n=this.shapes,s=[],e=0,i=n.length;i>e;e++)t=n[e],s.push(t.draw(ctxx));return s},t.prototype.update=function(){var t;for(t=null==t?this:t,t.fps(),this.draw(),this.accumulator>1.2*this.dt&&(this.accumulator=1.2*this.dt);this.accumulator>this.dt;)this.emit("update",{timestep:this.dt,cursor:new Vector(this.pageX,this.pageY),engine:this}),this.accumulator-=this.dt;return setTimeout(function(){return t.request.frame===!0?requestAnimationFrame(function(){return t.update()}):void 0},0)},t}(),Behaviour=function(){function t(){var t;this.active=!1,this.isSet=!1,t=arguments[0]}return t.prototype.activate=function(t,e,i){return this.engine=t,this.trigger=e,this.action=null==i?"apply":i,this.engine.on(this.trigger,this[this.action],this),this.active=!0},t.prototype.deactivate=function(){return this.reset(!0,{engine:this.engine}),this.engine.off({topic:this.trigger,fn:this[this.action]}),this.active=!1},t.prototype.isActivated=function(){return this.active},t.prototype.set=function(t){if(!t)throw new Error("Error: Undefined Mode or required parameter");return this.isSet?void 0:this.isSet=!0},t.prototype.apply=function(t,e){var i,n,s,r;if(i=e.engine,!this.isSet)throw new Error("not set");for(n in this.updates)hasProp.call(this.updates,n)&&(r=this.updates[n],i.on(n,r[0],r[1],n));s=[];for(n in this.resets)hasProp.call(this.resets,n)&&(r=this.resets[n],s.push(i.one(n,r[0],r[1],n)));return s},t.prototype.reset=function(t,e){var i,n,s;i=e.engine;for(n in this.updates)hasProp.call(this.updates,n)&&(s=this.updates[n],i.off({topic:n,fn:s[0]}));for(n in this.resets)if(hasProp.call(this.resets,n)){if(s=this.resets[n],n===t)continue;i.off({topic:n,fn:s[0]})}},t.prototype.getType=function(t){var e;if(e=t.type,!e||"Rectangle"!==e&&"Circle"!==e&&"Shape"!==e)throw new Error("name not available");return t.type},t}(),Collision=function(t){function e(t){var i,n;for(e.__super__.constructor.apply(this,arguments),this.updates={},n=0;n<t.length;n++)i=t[n],this.updates[i]=[this.update,this];this.set(!0)}return extend(e,t),e.prototype.activate=function(t){return this.apply(null,{engine:t}),this.active=!0},e.prototype.deactivate=function(){return this.reset(!0,{engine:this.engine}),this.active=!1},e.prototype.update=function(){},e}(Behaviour),CollisionControl=function(t){function e(){e.__super__.constructor.apply(this,arguments)}return extend(e,t),e.prototype.activate=function(t){return this.apply(t)},e.prototype.deactivate=function(){return e.__super__.deactivate.apply(this,arguments)},e.prototype.apply=function(t){return t.on("iterate",function(){var e,i,n,s;for(i=0;i<t.shapes.length;i++){e=t.shapes[i];for(s=0;s<t.shapes.length;s++)n=t.shapes[s],i>=s||(n.get("invM")||e.get("invM"))&&t.emit("checkColl: "+this.getType(e)+" - "+this.getType(n),{A:e,B:n,engine:t})}},this)},e}(Behaviour),AABB=function(t){function e(){e.__super__.constructor.call(this,["checkColl: Rectangle - Circle","checkColl: Circle - Rectangle","checkColl: Rectangle - Rectangle","checkColl: Circle - Circle"])}return extend(e,t),e.prototype.update=function(t,e){var i,n,s,r,o,a;if(i=e.A,n=e.B,s=e.engine,this.inside(i,n)||this.inside(n,i))for(o=0;o<i.shapes.length;o++){r=i.shapes[o];for(var h=0;h<n.shapes.length;h++)a=n.shapes[h],s.emit("AABB: "+this.getType(r)+" - "+this.getType(a),{A:r,B:a,engine:s})}},e.prototype.inside=function(t,e){var i,n;i=t.get("bounding"),n=e.get("bounding");var s=i[0].x,r=n[0].x,o=i[0].y,a=n[0].y,h=i[1].x,p=n[1].x,c=i[1].y,u=n[1].y,l=s>=p&&r>=s,d=r>=h&&s>=r,f=o>=u&&a>=o,y=a>=c&&o>=a;return!(!l&&!d||!f&&!y)},e}(Collision),GJK=function(t){function e(){e.__super__.constructor.call(this,["AABB: Shape - Shape"])}var i,n,s,r,o;return extend(e,t),e.prototype.simplex=function(t,e){var i,n,r,o,a;for(o=[],r=0,a=this.doSupport.bind(this,t,e),n=function(){return o[o.length-1]},i=t.get("position").subtract(e.get("position")),i=i.add(i.normal().scale(.5)),o.push(a(i)),i=i.scale(-1);r++<10;){if(r>=10)return!1;if(o.push(a(i)),abs(n().x)<.1&&abs(n().y)<.1)return!1;if(i.dot(n())<=0)return!1;if(this.containsOrigin(o,i))return s(o,a)}return!1},e.prototype.containsOrigin=function(t,e){var i,n,s,r,a,h,p,c,u;if(3===t.length)if(i=t[2],p=t[1],c=t[0],n=p.subtract(i),r=c.subtract(i),h=i.scale(-1),s=o(r,n,n),a=o(n,r,r),s.dot(h)>0)t.splice(0,1);else{if(!(a.dot(h)>0))return!0;t.splice(1,1)}return 2===t.length?(i=t[1],p=t[0],n=p.subtract(i),h=i.scale(-1),u=o(n,h,n),e.equal(u),!1):void 0},s=function(t,e){var s,r,o,a,h,p,c,u,l,d,f,y,g,v,m,w;for(g=0,r={p1:null,p2:null,normal:null,length:null,ratio:null},v={p1:null,p2:null,normal:null,length:null,ratio:null},w={p1:null,p2:null,normal:null,length:null,ratio:null},y=[r,v,w],a=[],p=0;p<t.length;p++)h=t[p],u=p+1===t.length?0:p+1,c=t[u],m=new i(h,c,t),n(m,y);for(;g++<10;){if(g>10)throw new Error("are you sure?");if(o=y[0],d=o.p1,f=o.p2,s=o.normal,e&&(l=e(s)),abs(s.dot(l)-s.dot(d))<.1||abs(s.dot(l)-s.dot(f))<.1)return o;y.splice(0,1),y.push(w),n(new i(d,l,t),y),n(new i(l,f,t),y)}return!1},n=function(t,e){var i,n,s,r;for(n=t,i=0;i<e.length;i++){if(s=e[i],null===s.normal){e[i]=n;break}t.length<s.length&&(r=e[i],e[i]=n,n=r)}return e},i=function(t,e,i){var n,s,r,a,h;if(this.p1=t,this.p2=e,this.simplex=i,n=this.p1,h=this.p2,s=h.subtract(n),a=n.scale(-1),r=s.dot(s),0===r)throw console.log(this),new Error("it is a zero!");return this.ratio=a.dot(s)/r,this.normal=o(a,s,s).scale(1/r),this.ratio<0&&(this.normal=n),this.ratio>1&&(this.normal=h),this.length=this.normal.dot(this.normal),this},o=function(t,e,i){return e.scale(i.dot(t)).subtract(t.scale(i.dot(e)))},r=function(t,e){var i;return i=t.subtract(e),i.p1=t,i.p2=e,i},e.prototype.doSupport=function(t,e,i){return r(t.support(i),e.support(i.scale(-1)))},e.prototype.getManifolds=function(t,e){var i,n,s,r,o,a,h,p,c,u,l;if(t.p1.p1!==t.p2.p1&&t.p1.p2!==t.p2.p2){for(a=-(1/0),h=null,p=1/0,c=null,i=t.p1.p1.subtract(t.p2.p1),u=e||[t.p1.p1,t.p2.p1,t.p1.p2,t.p2.p2],s=r=0,o=u.length;o>r;s=++r)n=u[s],l=n.dot(i),l>a&&(a=l,h=s),p>l&&(p=l,c=s);return u.splice(getMax(h,c),1),u.splice(getMin(h,c),1),u}},e.prototype.getNormals=function(t,e){var i,n,s,r,o,a,h;for(o=-(1/0),a=null,n=s=0,r=t.length;r>s;n=++s)i=t[n],h=i.dot(e),h>o&&(o=h,a=n);return null!=a?t[a]:!1},e.prototype.update=function(t,e){var i,n,s,r,o,a,h,p,c,u,l,d,f,y,g,v,m,w,b;if(i=e.A,s=e.B,h=e.engine,f=this.simplex(i,s)){for(d=[],y=null,b=f.normal.scale(-1),n=f.p1,r=f.p2,v="p2",m="p1",l=f.ratio,u=1-l,0>u?(o=r.p1,a=r.p2):0>l&&(o=n.p1,a=n.p2),o=n[v].scale(u).add(r[v].scale(l)),a=n[m].scale(u).add(r[m].scale(l)),d.push(new Line(o,a).middle()),w={},w.norm=this.getNormals(i.get("norms").concat(s.get("norms")),b),w.manifold=this.getManifolds(f),w.norm&&(y=w.norm),y||(y=b.unit()),w.manifold&&(d=w.manifold),g={vector:[],normal:y.copy(),manifold:d},c=0;c<d.length;c++)p=d[c],g.vector.push(b);h.emit("collided: "+this.getType(i)+" - "+this.getType(s),{cursor:new Vector(h.pageX,h.pageY),a:i,b:s,engine:this.engine,collision:g})}},e}(Collision),SATColl=function(t){function e(){e.__super__.constructor.call(this,["AABB: Shape - Shape"])}return extend(e,t),e.prototype.getShapeType=function(t){return t.shapeType},e.prototype.getAxies=function(t,e){var i,n,s,r,o,a,h,p,c,u,l;for(u=this.getShapeType(t),l=this.getShapeType(e),p=[],"Circle"===u&&(c=this.circleAxis(t,e),c.length&&(p=p.concat(c))),"Circle"===l&&(c=this.circleAxis(e,t),c.length&&(p=p.concat(c))),a=t.get("norms"),n=0,s=a.length;s>n;n++)i=a[n],p.push(i);for(h=e.get("norms"),o=0,r=h.length;r>o;o++)i=h[o],p.push(i);return p},e.prototype.circleAxis=function(t,e){var i,n,s,r,o,a,h,p;if("Circle"===this.getShapeType(e))return s=t.get("position").subtract(e.get("position")),s.getLength(),[s.unit()];for(o=t.get("position"),h=[],a=e.get("verticies"),n=0,r=a.length;r>n;n++)i=a[n],p=o.subtract(i),p.getLength(),h.push(p.unit());return h},e.prototype.removeDuplicateAxis=function(t){var e,i,n,s,r,o,a,h,p,c;for(c=[],n=s=0,r=t.length;r>s;n=++s){for(i=t[n],e=!1,h=p=0,o=t.length;o>p;h=++p)a=t[h],n>=h||e||abs(abs(i.dot(a))-1)<1e-7&&(e=!0);e||c.push(i)}return c},e.prototype.projectShape=function(t,e,i){var n,s;if(null==i)throw new Error("no booli");return s=t.support(e),n=s.subtract(t.get("position")).dot(e),i?n:e.scale(n)},e.prototype.optimizedSAT=function(t,e){var i,n,s,r,o,a,h,p,c,u,l,d,f,y;for(d=e.get("position").subtract(t.get("position")),y=this.getAxies(t,e),y=this.removeDuplicateAxis(y),h=null,p=1/0,s=r=0,o=y.length;o>r;s=++r){if(i=y[s],1!==i.length)throw new Error("not unit vector");if(l=d.dot(i),0>l&&(l*=-1,i=y[s]=i.scale(-1)),c=this.projectShape(t,i,!0),u=this.projectShape(e,i.scale(-1),!0),n=c+u-l,0>n)return!1;p>n&&(p=n,h=s)}if(null==h)throw new Error("no index!");if(a=y[h],l=d.projection(a),c=this.projectShape(t,a,!1),u=this.projectShape(e,a.scale(-1),!1),c.dot(u)>0)throw new Error("projections arent opposite");return c.dot(l)<0&&(l=l.scale(-1)),f=l.subtract(c).add(u),f.length=abs(a.dot(f)),f},e.prototype.closestEdge=function(t,e){var i,n,s,r,o;return r=t.support(e),r.edge1&&r.edge2?(i=r.edge1,n=r.edge2,abs(i.vector().unit().dot(e))<=abs(n.vector().unit().dot(e))?(s=i.p1===r?i.p2:i.p1,o=new Line(r,s),o.length=i.length,{type:"edge",edge:o,support:r}):(s=n.p1===r?n.p2:n.p1,o=new Line(r,s),o.length=n.length,{type:"edge",edge:o,support:r})):{type:"vector",edge:r}},e.prototype.getManifold=function(t,e,i){var n,s,r,o,a,h,p,c,u,l,d;return s=this.closestEdge(t,i),r=this.closestEdge(e,i.scale(-1)),"vector"===s.type?{points:[s.edge],flip:!1}:"vector"===r.type?{points:[r.edge],flip:!1}:(o=!1,abs(s.edge.vector().unit().dot(i))<=abs(r.edge.vector().unit().dot(i))?(l=s,a=r):(l=r,a=s,o=!0),c=a.edge.p1,u=a.edge.p2,d=l.edge.vector().unit(),p=d.dot(l.edge.p1),n=this.clippling(c,u,d,p),n.length<2?!1:(d=d.scale(-1),p=d.dot(l.edge.p2),n=this.clippling(n[0],n[1],d,p),n.length<2?!1:(i=i.scale(-1),o&&(i=i.scale(-1)),h=i.dot(l.support),n[0].depth=i.dot(n[0])-h,n[1].depth=i.dot(n[1])-h,n[1].depth<0&&n.splice(1,1),n[0].depth<0&&n.splice(0,1),{points:n,flip:o})))},e.prototype.clippling=function(t,e,i,n){var s,r,o,a,h;return s=[],r=t.dot(i)-n,o=e.dot(i)-n,r>=0&&s.push(t),o>=0&&s.push(e),0>r*o&&(a=e.subtract(t),h=r/(r-o),s.push(a.scale(h).add(t))),s},e.prototype.update=function(t,e){var i,n,s,r,o,a,h,p,c,u;if(i=e.A,n=e.B,r=e.engine,c=this.optimizedSAT(i,n),c&&(s={normal:c.unit()},p=this.getManifold(n,i,s.normal),p.points)){for(s.manifold=p.points,s.vector=[c,c],u=s.manifold,a=0,h=u.length;h>a;a++)o=u[a],s.vector.push(s.normal.scale(o.depth)),s.vector.splice(0,1);return r.emit("collided: "+this.getType(i)+" - "+this.getType(n),{cursor:new Vector(r.pageX,r.pageY),a:i,b:n,engine:this.engine,collision:s})}},e}(Collision),ImpulseResolution=function(t){function e(){e.__super__.constructor.call(this,["collided: Rectangle - Circle","collided: Circle - Rectangle","collided: Rectangle - Rectangle","collided: Circle - Circle","collided: Circle - Shape","collided: Shape - Circle","collided: Shape - Shape","collided: Shape - Rectangle","collided: Rectangle - Shape"])}return extend(e,t),e.prototype.calculateImpulse4=function(t,e,i,n,s,r){var o,a,h,p,c,u,l,d,f,y,g,v,m,w,b,x,_,S,C,E,M,A,L,k,I,V,q;return _=i.subtract(t.get("position")),S=i.subtract(e.get("position")),a=t.get("rv"),h=e.get("rv"),d=t.get("invM"),f=e.get("invM"),g=t.get("invI"),v=e.get("invI"),b=r.scale(-1),x=b.normal(),w=t.get("restitution"),o=e.get("restitution"),u=w*o,k=t.get("sf")*e.get("sf"),c=t.get("df")*e.get("df"),L=e.get("v").add(S.scaleCross(-h)).subtract(t.get("v")).subtract(_.scaleCross(-a)),p=L.dot(b),p>=0?!1:(C=-_.cross(b),M=-S.cross(b),y=d+f+sqr(C)*g+sqr(M)*v,l=p*-(1+u),l/=y,l/=n,e.applyForce(b.scale(l),S.add(e.get("position"))),t.applyForce(b.scale(-l),_.add(t.get("position"))),V=x,E=-_.cross(V),A=-S.cross(V),y=d+f+sqr(E)*g+sqr(A)*v,m=-L.dot(V),m/=y,I=L.dot(V)<0?-1:1,l*=I,q=abs(m)<l*k?V.scale(m):V.scale(-l*c),e.applyForce(q,S.add(e.get("position"))),t.applyForce(q.scale(-1),_.add(t.get("position"))))},e.prototype.positionalCorrection=function(t,e,i,n,s){var r,o,a;if(a=t||.4,(o=n.length)<.5&&(a=0),null==n.length)throw new Error("no positional correction");return r=n.scale(a/s),e.move(r.scale(e.get("invM"))),i.move(r.scale(-i.get("invM")))},e.prototype.impulseResolve=function(t,e,i){var n,s,r,o,a,h,p,c;if(!(h=t.get("invM")+e.get("invM")))return new Vector;for(n=i.vector[0],p=i.normal||n.unit(),s=i.manifold,r=this.positionalCorrection(null,t,e,n,h),c=[],a=0;a<s.length;a++)o=s[a],c.push(this.calculateImpulse4(t,e,o,s.length,i.vector[a],p));return c},e.prototype.update=function(t,e){var i,n,s,r;return i=e.a,n=e.b,"Shape"===this.getType(i)&&(i=i.body),"Shape"===this.getType(n)&&(n=n.body),s=e.collision,r=e.engine,i.get("invM")||n.get("invM")?this.impulseResolve(i,n,s):void 0},e}(Collision),Mouse=function(t){function e(t,e,i){if(this.selector=t,this.forbiddenElement=i,this.mouseChecker=bind(this.mouseChecker,this),this.emitMouseMove=bind(this.emitMouseMove,this),this.emitMouseUp=bind(this.emitMouseUp,this),this.emitMouseDown=bind(this.emitMouseDown,this),!this.selector)throw new Error("selector undefined");if("Jquery"!==e&&"jquery"!==e)throw new Error("undefined type");this.inputType="mouse"}return extend(e,t),e.prototype.activate=function(t){if(this.engine=t,!this.engine)throw new Error("engine not defined");if(this.engine.input)throw new Error("input already exists");return this.engine.setupInput(this.inputType,this.getMouseCoord),this.mouseClick()},e.prototype.deactivate=function(){return this.engine.resetInput(),this.mouseReset()},e.prototype.emitMouseDown=function(t){return this.engine.emit("mousedown",{cursor:new Vector(this.engine.pageX,this.engine.pageY),engine:this.engine})},e.prototype.emitMouseUp=function(t){return this.engine.emit("mouseup",{cursor:new Vector(this.engine.pageX,this.engine.pageY),engine:this.engine})},e.prototype.emitMouseMove=function(t){var e="CANVAS"===this.selector[0].tagName?this.selector[0].parentNode:this.selector[0],i=this.getAllOffsets(e);this.engine.pageX=t.pageX-i.left,this.engine.pageY=this.selector.height()-t.pageY+i.top},e.prototype.getAllOffsets=function(t){var e,i=0;if(!t.tagName||"BODY"===t.tagName)throw new Error("element is not a domElement");e=t;for(var n=t.offsetLeft,s=t.offsetTop;e&&"BODY"!==e.tagName&&10>i;)e=e.parentNode,n-=e.offsetLeft,s-=e.offsetTop,i++;return{left:n,top:s}},e.prototype.mouseClick=function(){var t=this;this.selector.on("mousemove.mouseInput",this.mouseChecker.bind(null,this.emitMouseMove)),this.selector.on("mousedown.mouseInput",function(e){t.mouseChecker(t.emitMouseMove,e),t.mouseChecker(t.emitMouseDown,e)}),this.selector.on("mouseup.mouseInput",function(e){t.mouseChecker(t.emitMouseMove,e),t.mouseChecker(t.emitMouseUp,e)}),this.selector[0].addEventListener("touchstart",this.touchHandler,!0),this.selector[0].addEventListener("touchmove",this.touchHandler,!0),this.selector[0].addEventListener("touchend",this.touchHandler,!0),this.selector[0].addEventListener("touchcancel",this.touchHandler,!0)},e.prototype.touchHandler=function(t){var e=t.changedTouches[0],i=document.createEvent("MouseEvent");i.initMouseEvent({touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup"}[t.type],!0,!0,window,1,e.pageX,e.pageY,e.clientX,e.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(i),t.preventDefault()},e.prototype.mouseReset=function(){return this.selector.off("mousemove.mouseInput"),this.selector.off("mousedown.mouseInput"),this.selector.off("mouseup.mouseInput")},e.prototype.mouseChecker=function(t,e){return this.forbiddenElement&&$.contains(this.forbiddenElement[0],e.target)?void 0:t(e)},e}(Behaviour),CanvasControl=function(t){function e(t,e,i,n){if(this.selector=t,this.context=e,this.window=i,this.adjustment=bind(this.adjustment,this),!this.selector)throw new Error("selector undefined");if(!this.context)throw new Error("context undefined");if(!this.window)throw new Error("window undefined");if("Jquery"!==n&&"jquery"!==n)throw new Error("undefined type");this.adjustment()}return extend(e,t),e.prototype.activate=function(t){if(this.engine=t,!this.engine)throw new Error("engine not defined");return this.adjusting()},e.prototype.deactivate=function(){return this.resetting()},e.prototype.adjustment=function(t){var e;return this.selector.attr("width",this.selector.parent().width()),this.selector.attr("height",this.selector.parent().height()),e=new CanvasCenter,this.context.translate(e.x,e.y),this.context.scale(1,-1),this.context.translate(-e.x,-e.y)},e.prototype.adjusting=function(){return this.window.on("resize.behaviour",this.adjustment)},e.prototype.resetting=function(){return this.window.off("resize.behaviour",this.adjustment)},e}(Behaviour),PlayPause=function(t){function e(){this.resets={pause:[this.reset,this]}}return extend(e,t),e.prototype.activate=function(t){return e.__super__.activate.call(this,t,"play","apply"),this.updates={update:[t.animate,t]}},e.prototype.deactivate=function(){return e.__super__.deactivate.apply(this,arguments)},e.prototype.apply=function(t,i){return e.__super__.apply.apply(this,arguments)},e.prototype.reset=function(t,i){return e.__super__.reset.apply(this,arguments)},e}(Behaviour),Refresh=function(t){function e(){}return extend(e,t),e.prototype.activate=function(t){return e.__super__.activate.call(this,t,"refresh","update")},e.prototype.deactivate=function(){return e.__super__.deactivate.apply(this,arguments)},e.prototype.update=function(t,e){var i;if(i=e.engine,!this.isSet)throw new Error("not set");return i.emit("pause",{cursor:new Vector(i.pageX,i.pageY),engine:i}),
i.shapes=[]},e}(Behaviour),Cord=function(t){function e(){this.strings=new Queue,this.updates={animate:[this.update,this],implement:[this.singleCord,this]},this.resets={destringify:[this.reset,this],refresh:[this.reset,this]}}return extend(e,t),e.prototype.set=function(t){return null==t&&(t={all:!0,massOnly:!1,maxLength:100}),this.massOnly=null==t.massOnly?!1:t.massOnly,this.maxLength=null==t.maxLength?100:t.maxLength,this.isSet=!0},e.prototype.activate=function(t){return e.__super__.activate.call(this,t,"stringify","apply")},e.prototype.deactivate=function(){return e.__super__.deactivate.apply(this,arguments)},e.prototype.apply=function(t,i){var n;return e.__super__.apply.apply(this,arguments),n=i.engine,this.createCords(n)},e.prototype.reset=function(t,i){var n;n=i.engine,this.strings.clear(),e.__super__.reset.apply(this,arguments)},e.prototype.createCords=function(t){var e,i,n,s,r,o;for(o=t.shapes,r=[],i=n=0,s=o.length;s>n;i=++n)e=o[i],r.push(this.singleCord(null,{shape:e,index:i,shapes:o}));return r},e.prototype.singleCord=function(t,e){var i,n,s,r,o,a,h,p;for(h=e.shape,i=e.index,p=e.shapes,a=[],o=n=0,s=p.length;s>n;o=++n)r=p[o],o>=i||(r.get("invM")||h.get("invM"))&&(!this.massOnly||r.get("invM")&&h.get("invM"))&&a.push(this.strings.queue([h,r]));return a},e.prototype.moveCord=function(t){var e,i,n,s,r,o,a,h,p,c,u,l;return e=t[0],i=t[1],o=e.get("invM"),a=i.get("invM"),l=new Line(e.get("position"),i.get("position")),p=l.vector(),p.getLength(),n=p.length<200?"grey":"red",c=p.unit(),u=i.get("v").subtract(e.get("v")),s=u.dot(c),s=0>=s?0:s,h=o+a,r=-1*s/h*.01,r=-abs(1/h*.001),o&&i.applyForce(c.scale(r)),a&&e.applyForce(c.scale(-r)),l.draw(.4,n)},e.prototype.update=function(t,e){var i,n,s,r,o,a,h;if(i=e.engine,h=i.shapes,!h)throw new Error("Error: no 'shapes' array present");for(o=this.strings.storage,a=[],s=0,r=o.length;r>s;s++)n=o[s],a.push(this.moveCord(n));return a},e}(Behaviour),Gravity=function(t){function e(){this.a=new Vector,this.updates={animate:[this.update,this]},this.resets={degravitate:[this.reset,this],refresh:[this.reset,this]}}return extend(e,t),e.prototype.set=function(t,e){var i;if(i="Error: Missing or Incorrect assignment of direction vector.\n Make sure the input direction vector is a unit vector and has a length property (of 1)",!e)throw new Error(i);if(e.length||e.getLength(),!(abs(e.length-1)<.1))throw new Error(i);return this.a=e.scale(t),this.isSet=!0},e.prototype.activate=function(t){return e.__super__.activate.call(this,t,"gravitate","apply")},e.prototype.deactivate=function(){return e.__super__.deactivate.apply(this,arguments)},e.prototype.apply=function(t,i){return e.__super__.apply.apply(this,arguments)},e.prototype.reset=function(t,i){return e.__super__.reset.apply(this,arguments)},e.prototype.update=function(t,e){var i,n,s,r,o,a;if(i=e.engine,a=i.shapes,!a)throw new Error("Error: no 'shapes' array present");for(r=[],n=0,s=a.length;s>n;n++)o=a[n],o.get("invM")?r.push(o.applyForce(this.a.scale(1/o.get("invM")))):r.push(void 0);return r},e}(Behaviour),Drag=function(t){function e(){this.velocity=new Vector,this.updates={animate:[this.update,this]},this.resets={mouseup:[this.reset,this],refresh:[this.reset,this]}}return extend(e,t),e.prototype.activate=function(t){return e.__super__.activate.call(this,t,"mousedown","apply")},e.prototype.deactivate=function(){return e.__super__.deactivate.apply(this,arguments)},e.prototype.apply=function(t,i){var n;if(n=i.engine,!this.isSet)throw new Error("not set");return this.mouseLoc=i.cursor,this.shape=this.findShape(n),this.shape?(this.refLoc=this.addPoint(this.mouseLoc.copy(),this.shape),e.__super__.apply.apply(this,arguments)):void 0},e.prototype.reset=function(t,i){return this.shape&&this.deletePoint(this.refLoc,this.shape),this.refLoc=null,this.shape=null,this.mouseLoc=null,e.__super__.reset.apply(this,arguments)},e.prototype.set=function(t,e,i){return this.speed=null==t?.01:t,this.pull=null==e?.71:e,this.torqueDamp=null==i?800:i,this.isSet=!0},e.prototype.firstClicked=function(t,e){var i;return i=e.engine,this.mouseLoc=e.cursor,this.shape=this.findShape(i),this.shape?(this.refLoc=this.addPoint(this.mouseLoc.copy(),this.shape),this.clicking=i.on("animate",this.update,this),i.on("mouseup",this.reset,this)):void 0},e.prototype.update=function(t,e){var i;if(!this.isSet)throw new Error("not set");return this.mouseLoc=e.cursor,i=e.engine,this.shape?(this.velocity=this.mouseLoc.subtract(this.refLoc),this.ropePull(this.shape,this.velocity,this.refLoc)):this.reset(null,e)},e.prototype.addPoint=function(t,e){var i,n;return(i=this.findPoint(t,e))?i:(n=e.shapes[0].get("points"),t.index=n.length,t.id=makeid(),n.push(t),t)},e.prototype.findPoint=function(t,e){var i,n,s,r;for(r=e.shapes[0].get("points"),n=0,s=r.length;s>n;n++)if(i=r[n],i.id===t.id)return i;return!1},e.prototype.deletePoint=function(t,e){var i,n;if(this.refLoc){if(!(i=this.findPoint(t,e)))throw new Error("Error: cannot find Point");return n=i.index,e.shapes[0].get("points").splice(n,1)}},e.prototype.findShape=function(t){var e,i,n,s;if(s=t.shapes,!s)throw new Error("Error: no 'shapes' array present");for(e=0,i=s.length;i>e;e++)if(n=s[e],n.inside(this.mouseLoc))return n;return!1},e.prototype.ropePull=function(t,e,i,n,s,r,o,a,h){var p,c,u,l,d,f,y,g,v;if(null==n&&(n=.03),null==r&&(r=100),null==o&&(o="lightgrey"),null==a&&(a=1.5),null==h&&(h="red"),!e)throw new Error("Error: missing force. Please define a force as a parameter for the function to operate");return p=o,e.length||e.getLength(),f=e.unit(),d=f.normal(),g=t.get("v"),u=f.dot(g),0>u&&e.length>r&&(c=e.length-r,y=g.projection(f),l=g.projection(d).scale(-1),t.applyForce(y.scale(-1),i),t.move(f.scale(.01*c*t.get("invM"))),t.applyForce(l.scale(n),i)),e.length>1.5*r&&(p=h,v=t.get("invM")/1e4,t.applyForce(e.scale(v),i)),i?new Line(i,i.add(e)).draw(a,p):void 0},e}(Behaviour),AddShape=function(superClass){function AddShape(t){this.count=0,this.mouseLoc=new Vector,this.locs=[],this.callBack=null}return extend(AddShape,superClass),AddShape.prototype.activate=function(t){return AddShape.__super__.activate.call(this,t,"mousedown","update")},AddShape.prototype.deactivate=function(){return AddShape.__super__.deactivate.apply(this,arguments)},AddShape.prototype.setVelocity=function(t,e,i){return i.v=e.subtract(t).scale(.003),i},AddShape.prototype.setLocation=function(t,e){return e.x=t.x,e.y=t.y,e},AddShape.prototype.firstOperation=function(t,e){return t.push(new Vector(e.x,e.y)),2!==t.length?!1:(this.shape.setLoc&&this.setLocation(t[0],this.shape),this.shape.setVel&&this.setVelocity(t[0],t[1],this.shape),this.shape)},AddShape.prototype.update=function(t,e){var i;if(this.isSet&&(i=e.engine,this.mouseLoc=e.cursor,!this.findShape(i))){if(this.count=i.shapes.length,!this.shape1)throw new Error("Error: Shapes are not defined");if(this.setShape(i),this.firstOperation(this.locs,this.mouseLoc))return this.locs=[],this.createdShape=this.createShape(this.shape),i.implement(this.createdShape),this.callBack?this.callBack(i):void 0}},AddShape.prototype.set=function(shape11,shape21,mode){var typesOfModes;if(this.shape1=null==shape11?null:shape11,this.shape2=null==shape21?null:shape21,typesOfModes=["container","random","target","compound"],typesOfModes.indexOf(mode)<0)throw new Error("Error: spawnMode unidentified");return this.setShape=eval("this."+mode),this.isSet=!0},AddShape.prototype.createShape=function(props){var construct;if(construct=props.type,!construct||"string"!=typeof construct||!eval(construct))throw new Error("Error: invalid or missing type");return new(eval(construct))(props)},AddShape.prototype.container=function(t){return 0!==this.count?this.shape=this.shape1:(t.implement(this.createShape({type:"Rectangle",x:jcan.width()/2,y:35,width:700,height:70,invM:0,sf:.5,df:.4,restitution:0})),t.implement(this.createShape({type:"Rectangle",x:jcan.width()-20,y:270,width:20,height:400,invM:0,sf:.3,df:.2,restitution:0})),t.implement(this.createShape({type:"Rectangle",x:20,y:270,width:20,height:400,invM:0,sf:.3,df:.2,restitution:0})),this.shape=this.shape1)},AddShape.prototype.random=function(){var t,e;return console.log(this.shape1),e=this.shape1.constructor===Array?this.shape1.length:1,t=this.shape1.constructor===Array?this.shape1:[this.shape1,this.shape2],this.shape=t[getRandomInt(0,e)]},AddShape.prototype.target=function(){return this.shape=function(){switch(this.count){case 1:return this.shape1;default:return this.shape2}}.call(this)},AddShape.prototype.compound=function(t){var e,i;return this.callBack||(this.callBack=this.CompoundCallback),i=_typeof(this.shape1.constructor)===Array?this.shape1.length:1,e=_typeof(this.shape1.constructor)===Array?this.shape1:[this.shape1,this.shape2],this.shape=e[getRandomInt(0,i)]},AddShape.prototype.CompoundCallback=function(t){var e,i,n,s;if(!this.initialComp)return this.initialComp=this.createdShape,t.one("refresh",function(){return this.initialComp=null},this);for(s=this.createdShape.shapes,i=0,n=s.length;n>i;i++)e=s[i],this.initialComp.addShape(e);return t.shapes.pop()},AddShape.prototype.findShape=function(t){var e,i,n,s;if(s=t.shapes,!s)throw new Error("Error: no 'shapes' array present");for(e=0,i=s.length;i>e;e++)if(n=s[e],n.inside(this.mouseLoc))return n;return!1},AddShape.prototype.setVelFn=function(t){return this.initCount?(this.initCount=null,this.initVel=null,t.v=new Vector(t.x,t.y).subtract(this.initLoc).scale(.003)):(this.initLoc=new Vector(t.x,t.y),this.initCount=!0,!1)},AddShape}(Behaviour),Presets=function(){function t(){this.storage=[],this.pickedIndex=-1,this.isSet=!1}return t.prototype.activate=function(t){return this.isSet?(this.engine=this.engine||t,this.storage[this.pickedIndex].activate(this.engine)):void 0},t.prototype.deactivate=function(){return this.isSet?this.storage[this.pickedIndex].deactivate():void 0},t.prototype.add=function(t,e){var i;return this.pickedIndex=this.pickedIndex<0?0:this.pickedIndex,this.isSet=this.isSet||!0,i=this.storage[this.storage.push(new e)-1],i.set.apply(i,t)},t.prototype.choose=function(t){if(0>t||t>this.storage.length-1)throw new Error("invalid index");return this.deactivate(),this.pickedIndex=t,this.activate(this.engine)},t}(),Vector=function(){function t(t,e){this.x=null==t?0:t,this.y=null==e?0:e}return t.prototype.copy=function(e,i){var n;return n=new t(this.x,this.y),n.length=this.length,n},t.prototype.move=function(t){this.x+=t.x,this.y+=t.y,this.length=this.a=void 0},t.prototype.equal=function(t){this.x=t.x,this.y=t.y,this.length=t.length,this.a=t.a},t.prototype.scale=function(e,i){var n;if(abs(e===1/0))throw new Error("infinity alert!");return n=new t(this.x*e,this.y*e),n.length=this.length*abs(e),n},t.prototype.subtract=function(e){return new t(this.x-e.x,this.y-e.y)},t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.scaleAdd=function(e){return new t(this.x+e,this.y+e)},t.prototype.getLength=function(){return this.length=sqrt(sqr(this.x)+sqr(this.y))},t.prototype.getAngle=function(){return this.a=atan2(this.y,this.x)},t.prototype.angle=function(t){var e;return e=this.a-t.a,0>e?2*pi+e:e>2*pi?e-2*pi:e},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y},t.prototype.cross=function(t){return this.dot(t.normal().scale(-1))},t.prototype.scaleCross=function(t){return this.normal().scale(-t)},t.prototype.unit=function(){var e;return this.x||this.y?(e=new t(this.x/this.length,this.y/this.length),e.length=1,e):(e=new t,e.length=0,e)},t.prototype.projection=function(t){var e,i;return i=t.unit(),e=this.dot(i),i=i.scale(e)},t.prototype.line=function(){return new Line(new t,this.copy())},t.prototype.normal=function(){var e;return e=new t(-this.y,this.x),e.length=this.length,e.a+=pi/2,e},t.prototype.farther=function(t,e){return e[t]>this[t]},t.prototype.farthest=function(t,e){return this.farther(t,e)?e:this},t.prototype.nearest=function(t,e){return this.farther(t,e)?this:e},t.prototype.rotate=function(e,i){var n,s,r,o,a;if("Vector"!==e.constructor.name)throw new Error(e);if("number"!=typeof i)throw new Error(i);return n=cos(i),a=sin(i),s=(this.x-e.x)*n-(this.y-e.y)*a+e.x,r=(this.x-e.x)*a+(this.y-e.y)*n+e.y,o=new t(s,r),o.length=this.length,o.a=this.a+i,o},t.prototype.draw2=function(t,e,i){var n,s,r;return s=null==t?new CanvasCenter:{x:0,y:0},r={x:this.x+s.x,y:this.y+s.y},n={type:"arc",fillStyle:"black",radius:3,x:r.x,y:r.y},jcan.draw(n),null!=e?(n={type:"line",strokeWidth:e||.5,strokeStyle:null==i?"black":i,x1:s.x,y1:s.y,x2:r.x,y2:r.y},jcan.draw(n)):void 0},t.prototype.draw=function(t,e,i){var n,s;s=null==t?new CanvasCenter:{x:0,y:0},n={x:this.x,y:this.y},n.x+=s.x,n.y+=s.y,ctxx.beginPath(),ctxx.fillStyle="black",ctxx.arc(n.x,n.y,3,0,2*pi),ctxx.fill(),null!=e&&(ctxx.beginPath(),ctxx.strokeStyle=null==i?"black":i,ctxx.lineWidth=e||.5,ctxx.moveTo(s.x,s.y),ctxx.lineTo(n.x,n.y),ctxx.stroke())},t.prototype.centroid=function(e){var i,n,s,r,o,a,h,p;if(i=this.sArea(e),!i)return this.centroidStraight(e);if(o=e.length,1===o)return e[0].copy();if(2===o)return new t((e[0].x+e[1].x)/2,(e[0].y+e[1].y)/2);for(n=e[o-1],h=new t,r=0,a=e.length;a>r;r++)s=e[r],p=n.cross(s),h.move(n.add(s).scale(p)),n=s;return p=1/(6*this.sArea(e)||1),h.scale(p)},t.prototype.centroidStraight=function(e){var i,n,s,r,o;for(s=e.length,o=new t,n=0,r=e.length;r>n;n++)i=e[n],o.x+=i.x,o.y+=i.y;return o.x/=s,o.y/=s,o},t.prototype.sArea=function(t){var e,i,n,s,r;for(r=0,e=t[t.length-1],n=0,s=t.length;s>n;n++)i=t[n],r+=e.cross(i),e=i;return r/2},t.prototype.invMOI=function(t,e){var i,n,s,r,o,a,h,p,c,u;if(o=e.length,1===o)return 0;if(2===o)return u=e[1].subtract(e[0]),u.dot(u)/12;for(h=0,c=0,i=e[0],s=r=0,a=e.length;a>r;s=++r)n=e[s],0!==s&&(p=abs(n.cross(i)),h+=p*(n.dot(n)+n.dot(i)+i.dot(i)),c+=p,i=n);return h?6*c*t/h:0},t}(),Line=function(){function t(t,e){this.p1=t,this.p2=e}return t.prototype.copy=function(e,i){return new t(this.p1.copy(),this.p2.copy())},t.prototype.move=function(t){return this.p1.move(t),this.p2.move(t)},t.prototype.getLength=function(){var t;return t=this.vector(),this.length=t.getLength()},t.prototype.add=function(e){return new t(this.p1.add(e),this.p2.add(e))},t.prototype.middle=function(){return new Vector((this.p1.x+this.p2.x)/2,(this.p1.y+this.p2.y)/2)},t.prototype.normal=function(){var t,e;return t=this.vector(),t=t.normal(),e=this.middle(),t=t.line().add(e),t.length=this.length,t},t.prototype.vector=function(){var t;return t=this.p2.subtract(this.p1),t.length=this.length,t},t.prototype.dot=function(t){var e,i;return e=this.vector(),i=t.vector(),e.dot(i)},t.prototype.rotate=function(t,e){return this.p1=this.p1.rotate(t,e),this.p2=this.p2.rotate(t,e)},t.prototype.closest=function(e){var i,n,s;return n=new t(e,this.p1),s=this.normal().vector(),s.getLength(),i=n.vector().projection(s),i.add(e)},t.prototype.intersects=function(t){var e,i,n,s,r,o;return s=this.vector(),o=t.vector(),r=o.cross(s),n=this.p1.subtract(t.p1),e=n.cross(s)/r,i=n.cross(o)/r,e>0&&1>=e&&i>0&&1>=i?this.p1.subtract(s.scale(-i)):!1},t.prototype.draw2=function(t,e){var i;return i={type:"line",strokeWidth:null==t?3:t,strokeStyle:e||"black",x1:this.p1.x,y1:this.p1.y,x2:this.p2.x,y2:this.p2.y},jcan.draw(i)},t.prototype.draw=function(t,e){return ctxx.beginPath(),ctxx.strokeStyle=e||"black",ctxx.lineWidth=null==t?3:t,ctxx.moveTo(this.p1.x,this.p1.y),ctxx.lineTo(this.p2.x,this.p2.y),ctxx.stroke()},t}(),Body=function(){function t(t){var e,i;if(this.physical={domains:[]},this.components=[this.physical],t){for(this.shapes=t.shapes||[],i=0;i<this.shapes.length;i++){if(e=this.shapes[i],i>=1)throw new Error("if you want more shapes, add them using the addShape function!");this.shapes[i]=new Shape(e),this.shapes[i].body=this}this.setPhysical(t),this.integrator=this.DefaultIntegrator}}return t.prototype.setPhysical=function(t){return this.physical.domains=this.physical.domains.concat(["v","rv","force","torque","sf","df","invM","invI","position","bounding","restitution"]),this.physical.force=new Vector,this.physical.torque=0,this.physical.rv=0,t?(this.physical.v=t.v?t.v.copy():new Vector,this.physical.sf=t.sf||0,this.physical.df=t.df||0,this.physical.restitution=t.restitution||0,this.physical.invM=t.invM||0,this.physical.invI=t.invI||this.physical.invM/100,this.physical.position=null!=t.x&&null!=t.y?new Vector(t.x,t.y):new Vector,this.determineCenter(),this.physical.bounding=[new Vector,new Vector],this.generateBounds(),this.determineinvMOI()):void 0},t.prototype.addShape=function(t){var e,i,n,s;return t.body=this,this.shapes.push(t),this.determineCenter(),this.generateBounds(),this.physical.invM?(n=1/this.physical.invM/(this.shapes.length-1),s=this.physical.position.subtract(t.physical.position),e=s.dot(s),i=1/t.determineinvMOI()+e,i*=n,this.physical.invI=1/(1/this.physical.invI+i),this.physical.invM=1/(n*this.shapes.length)):void 0},t.prototype.determineCenter=function(){var t,e,i,n,s,r,o,a;for(r=[],a=0,i=new Vector,o=this.shapes,n=0,s=o.length;s>n;n++)e=o[n],e.physical.area||e.calcArea(),t=e.physical.area,a+=t,i.move(e.physical.position.scale(t));return a?this.physical.position=i.scale(1/a):void 0},t.prototype.determineinvMOI=function(){var t,e,i,n,s;for(s=0,n=this.shapes,e=0,i=n.length;i>e;e++)t=n[e],s+=1/t.determineinvMOI();return this.physical.invI=this.physical.invM/s},t.prototype.get=function(t){var e,i,n,s,r,o,a,h;for(a=this.components,n=0,s=a.length;s>n;n++)for(e=a[n],h=e.domains,o=0,r=h.length;r>o;o++)if(i=h[o],t===i)return e[t]},t.prototype.set=function(t,e){var i,n,s,r,o,a,h,p;for(h=this.components,s=0,r=h.length;r>s;s++)for(i=h[s],p=i.domains,a=0,o=p.length;o>a;a++)if(n=p[a],t===n)return i[t]=e,!0;return!1},t.prototype.getShape=function(t){return t>=this.shapes.length||0>t?null:this.shapes[t]},t.prototype.setShape=function(t,e){return t>=this.shapes.length||0>t?null:this.shapes[t]=e},t.prototype.inside=function(t){var e,i,n,s;for(s=this.shapes,i=0,n=s.length;n>i;i++)if(e=s[i],e.inside(t))return!0;return!1},t.prototype.generateBounds=function(){var t,e,i,n,s,r,o,a,h;for(n=-(1/0),s=-(1/0),r=1/0,o=1/0,a=this.shapes,e=0,i=a.length;i>e;e++)t=a[e],t.generateBounds(),(h=t.physical.bounding[0].x)>n&&(n=h),(h=t.physical.bounding[0].y)>s&&(s=h),(h=t.physical.bounding[1].x)<r&&(r=h),(h=t.physical.bounding[1].y)<o&&(o=h);return this.physical.bounding[0].x=n,this.physical.bounding[0].y=s,this.physical.bounding[1].x=r,this.physical.bounding[1].y=o},t.prototype.draw=function(t){var e,i,n,s,r;for(n=this.shapes,s=[],e=0,i=n.length;i>e;e++)r=n[e],s.push(r.draw(t));return s},t.prototype.integrate=function(t){return this.integrator(t)},t.prototype.DefaultIntegrator=function(t){var e,i,n,s,r,o,a,h;for(this.physical.rv+=this.physical.torque,this.physical.v.move(this.physical.force),this.physical.position.move(this.physical.v.scale(t)),n=0;n<this.shapes.length;n++){for(i=this.shapes[n],i.physical.position.move(this.physical.v.scale(t)),s=0;s<i.physical.verticies.length;s++)e=i.physical.verticies[s],e.move(this.physical.v.scale(t));for(r=0;r<i.physical.points.length;r++)e=i.physical.points[r],e.move(this.physical.v.scale(t));for(i.physical.position.equal(i.physical.position.rotate(this.physical.position,this.physical.rv*t)),o=0;o<i.physical.verticies.length;o++)e=i.physical.verticies[o],e.equal(e.rotate(this.physical.position,this.physical.rv*t));for(a=0;a<i.physical.points.length;a++)e=i.physical.points[a],e.equal(e.rotate(this.physical.position,this.physical.rv*t));for(h=0;h<i.physical.norms.length;h++)e=i.physical.norms[h],e.equal(e.rotate(new Vector,this.physical.rv*t))}return this.generateBounds(),this.physical.force.x=0,this.physical.force.y=0,this.physical.torque=0},t.prototype.support=function(t){var e,i,n,s,r,o,a;for(s=-(1/0),r=null,i=null,n=0;n<this.shapes.length;n++)e=this.shapes[n],o=e.support(t),a=t.dot(o.subtract(this.physical.position)),a>s&&(s=a,r=o);return r},t.prototype.move=function(t){var e,i;for(null!=t&&this.physical.position.move(t),i=0;i<this.shapes.length;i++)e=this.shapes[i],e.move(t)},t.prototype.applyForce=function(t,e){var i,n;return this.physical.force.move(t.scale(this.physical.invM)),e?(n=e.subtract(this.physical.position),i=n.cross(t.scale(this.physical.invI)),this.physical.torque+=i,i):void 0},t}(),Shape=function(){function t(t){this.type="Shape",this.physical={domains:[]},this.appearance={domains:[]},this.components=[this.physical,this.appearance],this.setPhysical(t),this.setAppearance(t)}return t.prototype.setPhysical=function(t){return this.physical.domains=this.physical.domains.concat(["edges","norms","verticies","points","position","bounding","area"]),t?(this.physical.position=null!=t.x&&null!=t.y?new Vector(t.x,t.y):new Vector,this.physical.points=[],null!=t.points&&this.setVerticies(t.points),this.determineCenter(),null!=this.physical.verticies&&this.setEdges(),this.physical.bounding=[new Vector,new Vector],null!=this.physical.verticies&&this.generateBounds(),this.calcArea()):void 0},t.prototype.setVerticies=function(t){var e,i,n;if(!this.physical)throw new Error("no physical");for(this.physical.verticies=[],e=0,i=t.length;i>e;e++)n=t[e],this.physical.verticies.push(new Vector(n[0],n[1]))},t.prototype.setEdges=function(){var t,e,i,n,s,r,o,a;if(!this.physical)throw new Error("no physical");for(this.physical.edges=[],this.physical.norms=[],a=this.physical.verticies,i=n=0,s=a.length;s>n;i=++n)e=a[i],o=i+1<this.physical.verticies.length?i+1:0,r=this.physical.verticies[o],this.physical.edges.push(new Line(e,r)),t=this.physical.edges[i],e.edge1=e.edge1||t,r.edge2=r.edge2||t,t.getLength(),this.physical.norms.push(t.normal().vector().unit())},t.prototype.setAppearance=function(t){this.appearance.domains=this.appearance.domains.concat(["fill","strokeWidth","strokeStyle"]),t&&(this.appearance.fill=null==t.fill?generateRandomColor():t.fill,this.appearance.strokeWidth=null==t.stroke?null:t.stroke[0],this.appearance.strokeStyle=null==t.stroke?null:t.stroke[1])},t.prototype.get=function(t){var e,i,n,s,r,o,a,h;for(a=this.components,n=0,s=a.length;s>n;n++)for(e=a[n],h=e.domains,o=0,r=h.length;r>o;o++)if(i=h[o],t===i)return e[t]},t.prototype.set=function(t,e){var i,n,s,r,o,a,h,p;for(h=this.components,s=0,r=h.length;r>s;s++)for(i=h[s],p=i.domains,a=0,o=p.length;o>a;a++)if(n=p[a],t===n)return i[t]=e,!0;return!1},t.prototype.generateBounds=function(){var t,e,i,n,s,r,o,a,h;if(!this.physical.verticies)throw new Error("no verticies");for(n=-(1/0),s=-(1/0),r=1/0,o=1/0,a=this.physical.verticies,e=0,i=a.length;i>e;e++)t=a[e],(h=t.x)>n&&(n=h),(h=t.y)>s&&(s=h),(h=t.x)<r&&(r=h),(h=t.y)<o&&(o=h);return this.physical.bounding[0].x=n+10,this.physical.bounding[0].y=s+10,this.physical.bounding[1].x=r-10,this.physical.bounding[1].y=o-10},t.prototype.determineCenter=function(){return this.physical.position=this.physical.position.centroid(this.physical.verticies)},t.prototype.determineinvMOI=function(){var t,e,i,n,s;for(s=this.physical.verticies.concat([]),e=i=0,n=s.length;n>i;e=++i)t=s[e],s[e]=t.subtract(this.physical.position);return this.physical.position.invMOI(1,s)},t.prototype.calcArea=function(){return this.physical.area=abs(this.physical.position.sArea(this.physical.verticies))},t.prototype.inside=function(t){var e,i,n,s,r,o,a;for(o=this.physical.norms,n=s=0,r=o.length;r>s;n=++s)if(i=o[n],e=this.physical.edges[n],a=t.subtract(e.p1),a.dot(i)>0)return!1;return!0},t.prototype.support=function(t){var e,i,n,s,r,o,a,h;for(r=-(1/0),o=null,i=null,a=this.physical.verticies,n=0,s=a.length;s>n;n++)e=a[n],h=e.subtract(this.physical.position),h=t.dot(h),h>r&&(r=h,o=e);return o},t.prototype.move=function(t){var e,i,n,s,r,o,a,h,p,c,u;if(null!=t){for(this.physical.position.move(t),h=this.physical.bounding,i=0,n=h.length;n>i;i++)e=h[i],e.move(t);for(p=this.physical.verticies,o=0,s=p.length;s>o;o++)e=p[o],e.move(t);for(c=this.physical.points,u=[],a=0,r=c.length;r>a;a++)e=c[a],u.push(e.move(t));return u}},t.prototype.draw=function(t){var e,i,n,s,r;for(t.beginPath(),t.fillStyle=this.appearance.fill,t.strokeStyle=this.appearance.strokeStyle,t.lineWidth=this.appearance.strokeWidth,t.moveTo(this.physical.verticies[0].x,this.physical.verticies[0].y),r=this.physical.verticies,i=n=0,s=r.length;s>n;i=++n)e=r[i],i&&t.lineTo(e.x,e.y);return t.fill(),this.appearance.strokeWidth?t.stroke():void 0},t}(),Rectangle=function(t){function e(t){var i,n,s,r,o,a,h,p;if(p=Object.create(t),null==p.x||null==p.y)throw new Error("no position coords");if(!p.width||!p.height)throw new Error("no width and height");if(null==p.invM)throw new Error("no mass");for(p.invI=12*p.invM/(sqr(p.height)+sqr(p.width)),p.shapes=[],s=p.shapes[0]={fill:p.fill,stroke:p.stroke,x:p.x,y:p.y},h=new Vector(p.x,p.y),i=p.width/2,n=p.height/2,a=[[h.x+i,h.y+n],[h.x+i,h.y-n],[h.x-i,h.y-n],[h.x-i,h.y+n]],s.points=a,e.__super__.constructor.call(this,p),this.physical.invI=this.physical.invM*this.shapes[0].determineinvMOI(),o=0;o<this.shapes.length;o++)r=this.shapes[o],r.shapeType="Rectangle";this.type="Rectangle"}return extend(e,t),e}(Body),Circle=function(t){function e(t){var i,n,s,r,o,a,h;if(h=Object.create(t),null==h.x||null==h.y)throw new Error("no position coords");if(!h.radius)throw new Error("no radius");if(null==h.invM)throw new Error("no mass");for(h.invI=2*h.invM/sqr(h.radius),h.shapes=[],i=h.shapes[0]={fill:h.fill,stroke:h.stroke,x:h.x,y:h.y,radius:h.radius},o=[[i.x,i.y+h.radius]],i.points=o,e.__super__.constructor.call(this,h),a=this.shapes,s=0,r=a.length;r>s;s++)n=a[s],n.shapeType="Circle";this.shapes[0].physical.norms=[],this.type="Circle",this.shapes[0].physical.position=new Vector(i.x,i.y),this.physical.position=new Vector(i.x,i.y),this.shapes[0].edges=[],this.shapes[0].physical.domains.push("radius"),this.shapes[0].physical.radius=h.radius,this.shapes[0].determineinvMOI=function(){return 2/sqr(h.radius)},this.shapes[0].draw=function(t){return t.beginPath(),t.fillStyle=this.appearance.fill,t.strokeStyle=this.appearance.strokeStyle,t.lineWidth=this.appearance.strokeWidth,t.arc(this.physical.position.x,this.physical.position.y,this.physical.radius,0,2*pi),t.fill(),this.appearance.strokeWidth&&t.stroke(),new Line(this.physical.position,this.physical.verticies[0]).draw(1,"grey")},this.shapes[0].generateBounds=function(){var t=this.physical;t.bounding[0].x=t.position.x+t.radius+10,t.bounding[0].y=t.position.y+t.radius+10,t.bounding[1].x=t.position.x-t.radius-10,t.bounding[1].y=t.position.y-t.radius-10},this.shapes[0].support=function(t){return t.length||t.getLength(),t.unit().scale(this.physical.radius).add(this.physical.position)},this.shapes[0].inside=function(t){return t.subtract(this.physical.position).getLength()<this.physical.radius},this.shapes[0].calcArea=function(){return this.physical.area=pi*sqr(this.physical.radius)},this.shapes[0].determineCenter=function(){return this.physical.position},this.determineinvMOI(),this.determineCenter(),this.generateBounds()}return extend(e,t),e}(Body),Demo=function(){function Demo(t,e,i,n){if(this.engine=t,this.selector=e,this.context=i,this.window=n,!this.engine)throw new Error("Error: no engine");if(!this.selector)throw new Error("Error: no canvas");if(!this.context)throw new Error("Error: no context");if(!this.window)throw new Error("Error: no window");if(!$)throw new Error("Error: no jquery");this.listeners={},this.buttons={},this.behaviours={}}return Demo.prototype.init=function(){return this.setBehaviours(),this.setPresets(),this.setListeners(),this.setButtonViews(),this.setButtons()},Demo.prototype.setBehaviours=function(){var cnc,i,j,len1,mouse,behaviours;for(behaviours=["Drag","Gravity","PlayPause","Refresh","Cord","AddShape","Presets"],j=0;j<behaviours.length;j++)if(!eval(behaviours[j]))throw new Error("Error: missing "+behaviours[j]);return cnc=new CanvasControl(this.selector,this.context,this.window,"Jquery"),cnc.activate(this.engine),mouse=new Mouse($(".js-canvas"),"Jquery",$(".js-navigation")),mouse.activate(this.engine),this.behaviours.drag=new Drag,this.behaviours.drag.set(),this.behaviours.drag.activate(this.engine),this.behaviours.playPause=new PlayPause,this.behaviours.playPause.set(!0),this.behaviours.playPause.activate(this.engine),this.behaviours.gravity=new Gravity,this.behaviours.gravity.set(.008,new Vector(0,-1)),this.behaviours.gravity.activate(this.engine),this.behaviours.refresh=new Refresh,this.behaviours.refresh.set(!0),this.behaviours.refresh.activate(this.engine),this.behaviours.string=new Cord,this.behaviours.string.set({all:!0,massOnly:!0,maxLength:100}),this.behaviours.string.activate(this.engine)},Demo.prototype.setPresets=function(){var t,e,i,n,s,r,o,a,h,p,c,u,l,d;return c={type:"Rectangle",setLoc:!0,setVel:!0,x:400,y:200,width:200,height:30,invM:1/1.5,orient:0,sf:.8,df:.5,restitution:0,v:new Vector(-1,-.5)},u={type:"Rectangle",x:300,y:200,setLoc:!0,width:50,height:50,invM:1,orient:-.01,sf:.6,df:.4,restitution:0,v:new Vector(0,.2)},l={type:"Rectangle",x:300,y:200,setLoc:!0,width:40,height:50,invM:1,orient:-.01,sf:.6,df:.4,restitution:0,v:new Vector(0,.2)},i={type:"Circle",radius:getRandomInt(30,35),setLoc:!0,x:400,y:200,restitution:0,sf:.6,df:.4,invM:1},n={type:"Circle",radius:getRandomInt(5,50),setLoc:!0,x:400,y:200,restitution:0,sf:.6,df:.4,invM:.5},s=[i,c,"random"],r=[c,n,"target"],o=[c,u,"container"],a=[u,u,"compound"],h=[i,n,"container"],p=[u,c,"target"],this.behaviours.presets=new Presets,this.behaviours.presets.add(p,AddShape),this.behaviours.presets.add(a,AddShape),this.behaviours.presets.add(o,AddShape),this.behaviours.presets.add(r,AddShape),this.behaviours.presets.activate(this.engine),t=new AddShape,e={type:"Rectangle",x:47,y:100,width:900,height:50,invM:0,orient:0,sf:.8,df:.7,restitution:0},d=function(i){return function(){return i.engine.implement(t.createShape(e))}}(this),this.engine.on("refresh",d,this),d()},Demo.prototype.setListeners=function(){this.listeners.play=function(t){var e,i;return i=t.data.engine,e=t.data.button,i.emit("play",{cursor:new Vector(i.pageX,i.pageY),engine:i})},this.listeners.pause=function(t){var e,i;return i=t.data.engine,e=t.data.button,i.emit("pause",{cursor:new Vector(i.pageX,i.pageY),engine:i})},this.listeners.gravitate=function(t){var e,i;return i=t.data.engine,e=t.data.button,i.emit("gravitate",{cursor:new Vector(i.pageX,i.pageY),engine:i})},this.listeners.degravitate=function(t){var e,i;return i=t.data.engine,e=t.data.button,i.emit("degravitate",{cursor:new Vector(i.pageX,i.pageY),engine:i})},this.listeners.refresh=function(t){var e;return e=t.data.engine,e.emit("refresh",{cursor:new Vector(e.pageX,e.pageY),engine:e})},this.listeners.stringify=function(t){var e,i;return i=t.data.engine,e=t.data.button,i.emit("stringify",{cursor:new Vector(i.pageX,i.pageY),engine:i})},this.listeners.destringify=function(t){var e,i;return i=t.data.engine,e=t.data.button,i.emit("destringify",{cursor:new Vector(i.pageX,i.pageY),engine:i})},this.listeners.presets=function(t){var e,i,n,s;return n=t.data.engine,i=t.data.button,e=t.data.behaviour,n.emit("refresh",{cursor:new Vector(n.pageX,n.pageY),engine:n}),s=i.index,e.choose(s)}},Demo.prototype.setButtonViews=function(){var t,e,i,n,s,r;for(t=function(t,e,i){return t.addClass(e)},r=function(t,e,i){return t.removeClass(e)},this.buttons.refresh=new Action("refresh",".js-refresh"),this.engine.on("refresh",function(){var t,e,i,n;for(i=[this.buttons.gravity,this.buttons.string,this.buttons.play],n=[],e=0;e<i.length;e++)t=i[e],t.activated?(r.bind(null,t.selector[1],"applied")(),n.push(t.activated=!1)):n.push(void 0);return n},this),this.buttons.play=new Toggle("playPause",".js-play"),this.buttons.play.setListener("click",null,t.bind(null,this.buttons.play.selector[0],"applied"),r.bind(null,this.buttons.play.selector[1],"applied")),this.buttons.gravity=new Toggle("gravity",".js-gravity"),this.buttons.gravity.setListener("click",null,t.bind(null,this.buttons.gravity.selector[0],"applied"),r.bind(null,this.buttons.gravity.selector[1],"applied")),this.buttons.string=new Toggle("string",".js-string"),this.buttons.string.setListener("click",null,t.bind(null,this.buttons.string.selector[0],"applied"),r.bind(null,this.buttons.string.selector[1],"applied")),this.buttons.presets=new Radio("presets",".js-presets"),
s=0;s<this.buttons.presets.options;s++)n=this.buttons.presets.options[s],n.setListener("click",null,t.bind(null,n.selector[0],"applied")),n.setListener("internal",null,null,r.bind(null,n.selector[1],"applied"));this.buttons.hideOptions=new Toggle("hideOptions",".js-options-hamburger"),e=function(t,e,i,s,r){var o,a,h;for(a=[],o=0;o<t.length;o++)n=t[o],h=t.eq(o),a.push(i(h,s));return a},this.buttons.hideOptions.setListener("click",null,e.bind(null,$(".js-on-hamburger-collapse"),"applied",t,"sideHidden"),e.bind(null,$(".js-on-hamburger-collapse"),"applied",r,"sideHidden")),this.buttons.hideOptions.setListener("click",null,r.bind(null,this.buttons.hideOptions.selector[0],"is-opened"),t.bind(null,this.buttons.hideOptions.selector[1],"is-opened")),this.buttons.presetView1=new Toggle("presetView1","#presetHead");var o=function(t,e,i,n,s){var r,o,a,h;for(a=[],console.log("hidden?"),o=0;o<t.length;o++)r=t[o],h=t.eq(o),a.push(i(h,n));return a};return this.buttons.presetView1.setListener("click",null,o.bind(null,$(".js-presets"),"applied",t,"topHidden"),o.bind(null,$(".js-presets"),"applied",r,"topHidden")),this.buttons.presetView1.activate("click",null),this.buttons.presetView2=new Button("presetView2",".dropdown"),i=function(t,e,i,s,r){var o,a,h;for(a=[],o=0;o<t.length;o++)n=t[o],h=t.eq(o),a.push(i(h,s));return a},this.buttons.presetView2.setListener("mouseenter",null,i.bind(null,$(".js-presets"),"applied",r,"topHidden")),this.buttons.presetView2.assignDeactivation("mouseleave",null,i.bind(null,$(".js-presets"),"applied",t,"topHidden"))},Demo.prototype.setButtons=function(){var t,e,i,n,s;for(this.buttons.play.setListener("click",{engine:this.engine,button:this.buttons.play},this.listeners.play,this.listeners.pause),this.buttons.gravity.setListener("click",{engine:this.engine,button:this.buttons.gravity},this.listeners.gravitate,this.listeners.degravitate),this.buttons.refresh.setListener("click",{engine:this.engine,button:this.buttons.refresh},this.listeners.refresh),this.buttons.string.setListener("click",{engine:this.engine,button:this.buttons.string},this.listeners.stringify,this.listeners.destringify),n=this.buttons.presets.options,s=[],e=0,i=n.length;i>e;e++)t=n[e],s.push(t.setListener("click",{engine:this.engine,button:t,behaviour:this.behaviours.presets},this.listeners.presets));return s},Demo}();var world=window.world=new Engine($(".js-fps"));demo=new Demo(world,jcan,ctxx,win),demo.init(),(new CollisionControl).activate(world),(new AABB).activate(world),(new SATColl).activate(world),(new ImpulseResolution).activate(world);